<!DOCTYPE html>

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Ivy - Bound JavaScript</title>
	<meta name="author" content="Adam Sanderson">
	
	<link rel="stylesheet" href="../css/site.css" type="text/css" media="screen" charset="utf-8">
	<style>
	  #example-html {
	    min-height: 256px;
	  }
	</style>
	<script src="../src/ivy.js" type="text/javascript" charset="utf-8"></script>
	<script src="example_source.js" type="text/javascript" charset="utf-8"></script>
</head>
<body onload='init()'>
  <h1>Obligatory Todo List</h1>
  <p>
    The "Hello World" of 2012.
  </p>
  
  <hr/>
  
  <div id='example-html'>
    <form action="#" data-bind='with: active; event: submit addTodo'>
      <input placeholder='I need to...' type='text' data-bind='value: name'/>
      <input type='submit' value='Add' />
    </form>
    <ul class='todo-list' data-bind='each: list'>
      <li>
        <label>
          <input type='checkbox' data-bind='checked: isDone'>
          <span data-bind='text: name'>Task Name</span>
          <a data-bind='event: click ../deleteTodo'>(X)</a>
        </label> 
      </li>
    </ul>
    <div>
      <span data-bind='text: remainingCount'>N</span> things left
    </div>
  </div>
  
  <hr/>
  <div class='grid'>  
    <div class='row' id='example-source'>
      <div class='col col-6'>
        <h2>HTML</h2>
        <pre><code data-bind='text: html'></code></pre>
      </div>
      
      <div class='col col-6'>
        <h2>JavaScript</h2>
        <pre><code data-bind='text: js'></code></pre>
      </div>
    </div>
  </div>
  
  <script>
    function init(){
      initExample();
      Ivy.bindDom('example-source', new ExampleSource('example-html',initExample));
    }
    
    function initExample(){
      function TodoList(){
        this.active = Ivy.attr(new Todo);
        this.list   = Ivy.array([new Todo('Finish todo example')]);
        
        this.remainingCount = Ivy.fnWith(this, function(list){
          var count = 0;
          
          for (var i=0, len=list.length(); i < len; i++){
            if (!list.get(i).isDone.get()){
              count++;
            }
          }
          return count;
        });
      }
      
      TodoList.prototype.addTodo = function(){
        this.list.unshift(this.active.valueOf());
        this.active.set(new Todo);
      };
      
      TodoList.prototype.deleteTodo = function(todo){
        this.list.remove(todo);
      };
      
      function Todo(name){
        this.name   = Ivy.attr(name || '');
        this.isDone = Ivy.attr(false, Boolean);
      }
      
      Ivy.bindDom('example-html', new TodoList);
    }
    
  </script>
</body>
</html>
